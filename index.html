<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nuestra Historia â™¾ï¸ğŸ’–</title>
  <meta name="description" content="Diario romÃ¡ntico + agenda de fechas importantes con guardado automÃ¡tico (localStorage), exportaciÃ³n e impresiÃ³n." />

  <style>
    :root{
      --bg0:#0b0613;
      --bg1:#120720;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.14);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --soft: rgba(255,255,255,.55);
      --accent:#ff4da6;
      --accent2:#ffb3d9;
      --rose:#ff2f7b;
      --good:#37d67a;
      --warn:#ffd166;
      --bad:#ff5d5d;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --pad: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--txt);
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(255,77,166,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 10%, rgba(255,179,217,.14), transparent 50%),
        radial-gradient(700px 500px at 40% 90%, rgba(255,209,102,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
      overflow-x:hidden;
    }

    /* --- Portada animada --- */
    .cover{
      position:fixed; inset:0; z-index:9999;
      display:grid; place-items:center;
      padding:18px;
      background:
        radial-gradient(900px 520px at 20% 20%, rgba(255,77,166,.25), transparent 55%),
        radial-gradient(750px 480px at 80% 30%, rgba(255,179,217,.20), transparent 55%),
        radial-gradient(900px 600px at 50% 90%, rgba(255,209,102,.10), transparent 55%),
        linear-gradient(180deg, rgba(7,0,24,.96), rgba(18,7,32,.96));
      backdrop-filter: blur(8px);
      transition: opacity .35s ease, transform .35s ease;
    }
    .cover.hide{
      opacity:0; transform: translateY(-8px);
      pointer-events:none;
    }
    .coverCard{
      width:min(620px, 100%);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      border-radius: 26px;
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    .coverGlow{
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(255,77,166,.0), rgba(255,77,166,.32), rgba(255,179,217,.20), rgba(255,209,102,.12), rgba(255,77,166,.28), rgba(255,77,166,0));
      filter: blur(30px);
      animation: spin 10s linear infinite;
      opacity:.9;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .coverInner{position:relative; padding:18px}
    .coverTop{
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:14px 14px 10px;
    }
    .seal{
      display:flex; gap:10px; align-items:center;
      user-select:none;
    }
    .seal .rose{
      width:48px; height:48px; border-radius:16px;
      display:grid; place-items:center;
      background: radial-gradient(circle at 30% 30%, var(--accent2), var(--rose));
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      font-size:22px;
      transform: translateZ(0);
      animation: floaty 3.2s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-6px)}
    }
    .coverTitle{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
      line-height:1.15;
    }
    .coverSub{
      margin:6px 0 0;
      color:rgba(255,255,255,.78);
      font-size:13px;
      line-height:1.4;
    }
    .coverBody{padding:0 14px 14px}
    .coverGrid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width: 560px){
      .coverGrid{grid-template-columns:1fr}
    }
    .miniCard{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      border-radius:18px;
      padding:12px;
    }
    .miniCard .k{color:rgba(255,255,255,.70); font-size:12px}
    .miniCard .v{margin-top:6px; font-weight:850; font-size:15px}
    .coverActions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between;
      padding:14px;
      border-top:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .coverActions .btn{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--txt);
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:850;
      letter-spacing:.2px;
      transition: transform .06s ease, background .2s ease, border .2s ease;
      display:inline-flex; gap:8px; align-items:center;
    }
    .coverActions .btn:hover{background: rgba(255,255,255,.12)}
    .coverActions .btn:active{transform: translateY(1px)}
    .coverActions .btn.primary{
      border-color: rgba(255,47,123,.55);
      background: linear-gradient(180deg, rgba(255,47,123,.24), rgba(255,47,123,.10));
    }
    .coverNote{
      margin:10px 0 0;
      color:rgba(255,255,255,.68);
      font-size:12px;
    }

    /* Petalos */
    .petals{position:absolute; inset:0; overflow:hidden; pointer-events:none}
    .petal{
      position:absolute; top:-60px;
      width:14px; height:18px;
      border-radius: 60% 40% 60% 40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,179,217,.95), rgba(255,47,123,.78));
      opacity:.75;
      filter: blur(.1px);
      transform: rotate(15deg);
      animation: fall linear infinite;
    }
    @keyframes fall{
      to{ transform: translateY(calc(100vh + 90px)) rotate(260deg); }
    }

    header{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.25));
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:14px 16px}
    .top{
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: radial-gradient(circle at 30% 30%, var(--accent2), var(--accent));
      box-shadow: var(--shadow);
      display:grid;place-items:center;
      font-size:22px;
      user-select:none;
    }
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{margin:2px 0 0;color:var(--muted);font-size:12.5px}

    .actions{display:flex;gap:8px;flex-wrap:wrap; align-items:center}
    button, .chip{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border .2s ease;
      font-weight:650;
      letter-spacing:.2px;
    }
    button:hover{background: rgba(255,255,255,.10)}
    button:active{transform: translateY(1px)}
    .primary{
      border-color: rgba(255,77,166,.45);
      background: linear-gradient(180deg, rgba(255,77,166,.22), rgba(255,77,166,.10));
    }
    .danger{
      border-color: rgba(255,93,93,.50);
      background: linear-gradient(180deg, rgba(255,93,93,.18), rgba(255,93,93,.08));
    }
    .ghost{background: transparent;}
    .tiny{
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }

    main{max-width:1100px;margin:0 auto;padding:16px 16px 92px}
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
    }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .card .hd .title{font-size:14.5px;font-weight:800;letter-spacing:.3px}
    .card .hd .desc{margin-top:4px;color:var(--muted);font-size:12.5px;line-height:1.35}
    .card .bd{padding:14px}

    label{display:block;color:var(--muted);font-size:12px;margin:10px 0 6px}
    input[type="text"], input[type="date"], input[type="time"], textarea, select{
      width:100%;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      border-radius: 12px;
      padding:10px 11px;
      outline:none;
    }
    textarea{min-height:120px;resize:vertical;line-height:1.45}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row3{display:grid;grid-template-columns:1.2fr .8fr .8fr;gap:10px}
    @media (max-width: 560px){
      .row,.row3{grid-template-columns:1fr}
    }
    .mini{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .hint{color:var(--soft);font-size:12px;margin-top:8px;line-height:1.35}
    .list{display:flex;flex-direction:column;gap:10px}
    .item{
      border:1px solid var(--line);
      background: var(--card2);
      border-radius: var(--radius2);
      padding:12px;
    }
    .item .topline{
      display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap
    }
    .tag{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      opacity:.95;
    }
    .item h3{
      margin:6px 0 6px;
      font-size:14.5px;
      letter-spacing:.2px
    }
    .item p{
      margin:0;color:rgba(255,255,255,.84);
      white-space:pre-wrap;
      line-height:1.45;
      font-size:13.5px;
    }
    .item .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .pill{
      display:inline-flex;align-items:center;gap:6px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      padding:7px 10px;border-radius:999px;
      color:var(--muted);font-size:12px
    }
    .searchbar{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap
    }
    .searchbar input{flex:1;min-width:220px}
    .split{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .kpi{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .kpi .chip{
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }
    .footerNote{
      margin-top:14px;
      color:var(--soft);
      font-size:12px;
      text-align:center;
      opacity:.9
    }
    .love{
      font-weight:800;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }

    /* Contador days juntos (badge) */
    .togetherBadge{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      padding:8px 10px;
      border-radius: 999px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-size:12px;
      color:rgba(255,255,255,.80);
      user-select:none;
    }
    .togetherBadge b{color:#fff}
    .roseBtn{
      width:38px; height:38px;
      display:grid; place-items:center;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition: transform .06s ease, background .2s ease;
      user-select:none;
    }
    .roseBtn:hover{background: rgba(255,255,255,.10)}
    .roseBtn:active{transform: translateY(1px)}

    /* Modal */
    .modalBack{
      position:fixed; inset:0; z-index:9998;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      display:none;
      padding:18px;
    }
    .modalBack.show{display:grid; place-items:center}
    .modal{
      width:min(720px, 100%);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(15,8,26,.92);
      border-radius: 22px;
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modalHd{
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .modalHd .t{font-weight:900; letter-spacing:.2px}
    .modalHd .s{margin-top:4px; font-size:12px; color:rgba(255,255,255,.74); line-height:1.35}
    .modalBd{padding:14px}
    .modalRow{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 560px){ .modalRow{grid-template-columns:1fr} }
    .modalActions{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .closeX{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:#fff;
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:900;
    }

    /* Barra inferior mÃ³vil */
    .dock{
      position:fixed;
      left:12px; right:12px; bottom:12px;
      z-index:50;
      display:none;
      gap:10px;
      padding:10px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .dock button{flex:1; padding:12px 10px; border-radius:16px}
    @media (max-width: 780px){
      .actions.no-print{display:none}
      .dock{display:flex}
      main{padding-bottom:120px}
    }

    /* Print */
    @media print{
      header, .no-print, .dock, .cover, .modalBack{display:none !important}
      body{background:#fff;color:#000}
      .card, .item{box-shadow:none;background:#fff;border:1px solid #ddd}
      .love{color:#000 !important;-webkit-text-fill-color:#000}
      .tag, .desc, .hint, .chip, .pill{color:#333 !important}
      input, textarea, select{border:1px solid #bbb;color:#000;background:#fff}
    }
  </style>
</head>

<body>

<!-- PORTADA -->
<section class="cover" id="cover">
  <div class="coverCard">
    <div class="coverGlow"></div>
    <div class="petals" id="petals"></div>

    <div class="coverInner">
      <div class="coverTop">
        <div class="seal">
          <div class="rose">ğŸŒ¹</div>
          <div>
            <h2 class="coverTitle">Nuestra Historia <span class="love">para la eternidad</span> â™¾ï¸</h2>
            <div class="coverSub">TradiciÃ³n: escribir lo que se siente. Futuro: guardarlo sin miedo. Y sÃ­â€¦ con rosa incluida. ğŸŒ¹</div>
          </div>
        </div>
      </div>

      <div class="coverBody">
        <div class="coverGrid">
          <div class="miniCard">
            <div class="k">ğŸ•¯ï¸ Contador</div>
            <div class="v" id="coverTogether">â€”</div>
            <div class="coverNote">Desde la fecha que tÃº definas. (Puedes cambiarla en Ajustes).</div>
          </div>
          <div class="miniCard">
            <div class="k">ğŸ’Œ Secreto</div>
            <div class="v">AquÃ­ viven mensajes escondidos.</div>
            <div class="coverNote">No es magiaâ€¦ es privacidad con estilo. ğŸ˜Œ</div>
          </div>
        </div>
      </div>

      <div class="coverActions">
        <button class="btn primary" id="btnEnter">ğŸ’– Entrar</button>
        <button class="btn" id="btnOpenSettings">âš™ï¸ Ajustes</button>
        <button class="btn" id="btnOpenSecret">ğŸ’Œ Secretos</button>
      </div>
    </div>
  </div>
</section>

<header>
  <div class="wrap top">
    <div class="brand">
      <div class="logo" title="Rosa: mantÃ©n presionado para abrir secretos ğŸ˜‰" id="roseHeader">ğŸŒ¹</div>
      <div>
        <h1>Nuestra Historia <span class="love">para la eternidad</span> â™¾ï¸</h1>
        <div class="sub">
          Diario + agenda romÃ¡ntica. Se guarda en tu navegador.
          <span class="togetherBadge" id="togetherBadge">ğŸ•¯ï¸ <span>Juntos:</span> <b id="togetherText">â€”</b></span>
        </div>
      </div>
    </div>

    <div class="actions no-print">
      <div class="roseBtn" id="btnSecretQuick" title="Secretos ğŸ’Œ">ğŸ’Œ</div>
      <div class="roseBtn" id="btnSettingsQuick" title="Ajustes âš™ï¸">âš™ï¸</div>
      <button class="primary" id="btnNewEntry">â• Nueva pÃ¡gina</button>
      <button id="btnNewDate">ğŸ“… Nueva fecha</button>
      <button id="btnExport">â¬‡ï¸ Exportar</button>
      <button id="btnImport">â¬†ï¸ Importar</button>
      <button class="ghost" id="btnPrint">ğŸ–¨ï¸ Imprimir</button>
      <button class="danger" id="btnReset">ğŸ§¨ Borrar todo</button>
      <input id="fileImport" type="file" accept="application/json" style="display:none" />
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- Diario -->
    <section class="card">
      <div class="hd">
        <div class="title">ğŸ“– Diario de amor (las pÃ¡ginas de â€œnosotrosâ€)</div>
        <div class="desc">Escribe bonito, escribe claro. AquÃ­ no hay â€œcasiâ€: aquÃ­ hay historia.</div>
      </div>
      <div class="bd">
        <div class="row">
          <div>
            <label>Para quiÃ©n (opcional)</label>
            <input type="text" id="toWho" placeholder="Ej: Para Fran ğŸ’˜" />
          </div>
          <div>
            <label>Emoji mood</label>
            <select id="mood">
              <option value="ğŸ’–">ğŸ’– Amor</option>
              <option value="ğŸ˜">ğŸ˜ Enamorada</option>
              <option value="ğŸ¥¹">ğŸ¥¹ Ternura</option>
              <option value="ğŸ”¥">ğŸ”¥ PasiÃ³n</option>
              <option value="ğŸ˜‚">ğŸ˜‚ Risa</option>
              <option value="ğŸ«¶">ğŸ«¶ Gracias</option>
              <option value="ğŸ’Œ">ğŸ’Œ Carta</option>
              <option value="ğŸŒ™">ğŸŒ™ Noches</option>
              <option value="â˜€ï¸">â˜€ï¸ DÃ­as</option>
              <option value="ğŸŒ¹">ğŸŒ¹ Rosa</option>
            </select>
          </div>
        </div>

        <label>TÃ­tulo de la pÃ¡gina</label>
        <input type="text" id="entryTitle" placeholder="Ej: El dÃ­a que tu â€˜sÃ­â€™ me cambiÃ³ el destino âœ¨" />

        <label>Texto (tu voz, sin filtro)</label>
        <textarea id="entryText" placeholder="Escribe aquÃ­â€¦ ğŸ’&#10;Tip: usa saltos de lÃ­nea, se guardan."></textarea>

        <div class="mini no-print">
          <button class="primary" id="btnSaveEntry">ğŸ’¾ Guardar pÃ¡gina</button>
          <button id="btnClearEntry">ğŸ§½ Limpiar</button>
          <span class="pill" id="autosaveState">Autoguardado: listo âœ…</span>
        </div>

        <div class="hint">
          Se guarda automÃ¡ticamente mientras escribes. Lo romÃ¡ntico no estÃ¡ peleado con la disciplina. ğŸ˜Œ
        </div>

        <hr style="border:none;border-top:1px solid var(--line);margin:14px 0" />

        <div class="searchbar no-print">
          <input type="text" id="searchEntries" placeholder="ğŸ” Buscar en tu historia (palabras, emojis, fechasâ€¦)" />
          <button id="btnSortEntries">â†•ï¸ Orden: reciente</button>
        </div>

        <div class="split">
          <div class="kpi">
            <span class="chip">ğŸ“š PÃ¡ginas: <b id="countEntries">0</b></span>
            <span class="chip">ğŸ—“ï¸ Fechas: <b id="countDates">0</b></span>
          </div>
          <div class="tag" id="lastSaved">Ãšltimo guardado: â€”</div>
        </div>

        <div style="height:10px"></div>
        <div class="list" id="entriesList"></div>

        <div class="footerNote">
          â€œLo escrito queda.â€ Y si lo exportasâ€¦ queda blindado. ğŸ“œğŸ˜‰
        </div>
      </div>
    </section>

    <!-- Agenda + lÃ­nea del tiempo -->
    <aside class="card">
      <div class="hd">
        <div class="title">ğŸ“… Fechas importantes + lÃ­nea del tiempo</div>
        <div class="desc">Anota lo que importa. Lo demÃ¡sâ€¦ que lo resuelva el universo.</div>
      </div>
      <div class="bd">

        <div class="row3">
          <div>
            <label>Nombre del momento</label>
            <input type="text" id="dateName" placeholder="Ej: Nuestro aniversario ğŸ’" />
          </div>
          <div>
            <label>Fecha</label>
            <input type="date" id="dateDay" />
          </div>
          <div>
            <label>Hora (opcional)</label>
            <input type="time" id="dateTime" />
          </div>
        </div>

        <label>Detalle (opcional)</label>
        <textarea id="dateNote" style="min-height:90px" placeholder="Ej: Cena, carta, detalleâ€¦ y cero pretextos ğŸ˜Œ"></textarea>

        <div class="mini no-print">
          <button id="btnSaveDate">ğŸ’¾ Guardar fecha</button>
          <button id="btnClearDate">ğŸ§½ Limpiar</button>
        </div>

        <div class="hint">
          Tip tradicional: una fecha sin detalle es como promesa sin hechos. AjÃ¡. ğŸ˜Œ
        </div>

        <hr style="border:none;border-top:1px solid var(--line);margin:14px 0" />

        <div class="no-print">
          <label>Recordatorio (solo visual)</label>
          <select id="reminderWindow">
            <option value="0">Hoy</option>
            <option value="1">En 1 dÃ­a</option>
            <option value="3">En 3 dÃ­as</option>
            <option value="7">En 7 dÃ­as</option>
            <option value="14">En 14 dÃ­as</option>
            <option value="30">En 30 dÃ­as</option>
          </select>
          <div class="hint">AquÃ­ solo marca lo prÃ³ximo con colores. Notificaciones â€œdel sistemaâ€ ya es otra historia.</div>
        </div>

        <div style="height:10px"></div>
        <div class="list" id="datesList"></div>

        <hr style="border:none;border-top:1px solid var(--line);margin:14px 0" />

        <div class="item">
          <div class="topline">
            <div class="tag">ğŸ§· Promesa</div>
            <div class="pill">ğŸ’</div>
          </div>
          <h3>Manifiesto corto (para cuando la vida quiera ponerse intensa)</h3>
          <p id="manifest">No se trata de perfecto, se trata de leal.
No se trata de hablar bonito, se trata de cumplir.
Y si el mundo se aceleraâ€¦ nosotros nos tomamos de la mano y lo alcanzamos.</p>
          <div class="btns no-print">
            <button id="btnEditManifest">âœï¸ Editar manifiesto</button>
          </div>
        </div>

        <div class="footerNote">
          Esto es tu altar digital. Ãšsalo como se debe. ğŸ•¯ï¸ğŸ’»
        </div>
      </div>
    </aside>

  </div>
</main>

<!-- Dock mÃ³vil -->
<div class="dock no-print">
  <button class="primary" id="dockNewEntry">â• PÃ¡gina</button>
  <button id="dockNewDate">ğŸ“… Fecha</button>
  <button id="dockSecret">ğŸ’Œ</button>
  <button id="dockSettings">âš™ï¸</button>
</div>

<!-- Modal AJUSTES -->
<div class="modalBack no-print" id="settingsBack" aria-hidden="true">
  <div class="modal">
    <div class="modalHd">
      <div>
        <div class="t">âš™ï¸ Ajustes</div>
        <div class="s">AquÃ­ decides desde cuÃ¡ndo cuentan los dÃ­as juntos. TradiciÃ³n: fecha clara. Futuro: contador vivo. ğŸ•¯ï¸</div>
      </div>
      <button class="closeX" id="settingsClose">âœ–</button>
    </div>
    <div class="modalBd">
      <div class="modalRow">
        <div>
          <label>Inicio (fecha)</label>
          <input type="date" id="togetherDate" />
        </div>
        <div>
          <label>Inicio (hora)</label>
          <input type="time" id="togetherTime" />
        </div>
      </div>

      <label>Etiqueta (opcional)</label>
      <input type="text" id="togetherLabel" placeholder="Ej: Desde que dijimos â€˜sÃ­â€™ ğŸ’" />

      <div class="modalActions">
        <button class="primary" id="btnSaveSettings">ğŸ’¾ Guardar ajustes</button>
        <button id="btnCloseSettings">Cerrar</button>
      </div>

      <div class="hint">
        Si no pones hora, se asume 00:00. Consejo serio: pon la hora real, y queda fino. ğŸ˜Œ
      </div>
    </div>
  </div>
</div>

<!-- Modal SECRETOS -->
<div class="modalBack no-print" id="secretBack" aria-hidden="true">
  <div class="modal">
    <div class="modalHd">
      <div>
        <div class="t">ğŸ’Œ Mensajes secretos</div>
        <div class="s">Solo se abren con tu clave. No es â€œhackerâ€, es sentido comÃºn con glitter. ğŸŒ¹</div>
      </div>
      <button class="closeX" id="secretClose">âœ–</button>
    </div>
    <div class="modalBd">
      <div class="modalRow">
        <div>
          <label>Clave</label>
          <input type="text" id="secretKey" placeholder="Escribe tu clave (ej: una frase)" />
        </div>
        <div>
          <label>AcciÃ³n</label>
          <button class="primary" id="btnUnlock">ğŸ”“ Abrir / Desbloquear</button>
        </div>
      </div>

      <div id="secretZone" style="display:none">
        <label>Escribe tu mensaje secreto</label>
        <textarea id="secretText" placeholder="AquÃ­ va lo que NO es para ojos curiososâ€¦"></textarea>

        <div class="modalActions">
          <button class="primary" id="btnSaveSecret">ğŸ’¾ Guardar secreto</button>
          <button id="btnLock">ğŸ”’ Cerrar</button>
        </div>

        <div class="hint">
          Ojo: esto es â€œprivado casualâ€ (no cifrado militar). Si quieres nivel bÃ³veda, te lo subo despuÃ©s con cifrado fuerte.
        </div>
      </div>

      <div class="hint" id="secretHint">
        Tip: mantÃ©n presionada la ğŸŒ¹ del header 1 segundo para abrir esto rÃ¡pido.
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const KEY = "HISTORIA_NOSOTROS_V2";
  const nowISO = () => new Date().toISOString();
  const el = (id) => document.getElementById(id);

  // --- Estado ---
  const state = {
    meta: { createdAt: nowISO(), updatedAt: nowISO() },
    manifest: "",

    // ğŸ•¯ï¸ contador juntos
    together: {
      startDate: "2025-08-06",   // valor por defecto (puedes cambiar en Ajustes)
      startTime: "20:00",
      label: "Desde nuestro â€˜sÃ­â€™ ğŸ’"
    },

    // ğŸ’Œ secretos (guardamos â€œofuscadoâ€, no militar)
    secrets: {
      // hash simple de clave + payload ofuscado
      keyHash: "",
      payload: "" // base64(xor)
    },

    entries: [],
    dates: [],
    ui: { sortEntries: "desc" } // desc = reciente primero
  };

  // --- Utilidades ---
  function sanitize(s){ return (s || "").toString().trim(); }
  function escapeHtml(str){
    return (str || "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }
  function uid(){
    return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
  }
  function load(){
    const raw = localStorage.getItem(KEY);
    if(!raw) return;
    try{
      const saved = JSON.parse(raw);
      if(saved && typeof saved === "object"){
        // merge suave (mantiene defaults)
        Object.assign(state, saved);
        state.together = { ...state.together, ...(saved.together || {}) };
        state.secrets  = { ...state.secrets,  ...(saved.secrets  || {}) };
        state.ui       = { ...state.ui,       ...(saved.ui       || {}) };
      }
    }catch(e){
      console.warn("No se pudo cargar:", e);
    }
  }
  function save(){
    state.meta.updatedAt = nowISO();
    localStorage.setItem(KEY, JSON.stringify(state));
    el("lastSaved").textContent = "Ãšltimo guardado: " + new Date().toLocaleString();
    pulseAutosave();
    renderAll();
  }

  let autosaveTimer = null;
  function scheduleSave(){
    clearTimeout(autosaveTimer);
    autosaveTimer = setTimeout(save, 220);
  }
  function pulseAutosave(){
    const badge = el("autosaveState");
    badge.textContent = "Autoguardado: listo âœ…";
    badge.style.borderColor = "rgba(55,214,122,.55)";
    setTimeout(() => badge.style.borderColor = "rgba(255,255,255,.14)", 450);
  }

  // --- Portada pÃ©talos ---
  function seedPetals(){
    const host = el("petals");
    if(!host) return;
    host.innerHTML = "";
    const n = 18;
    for(let i=0;i<n;i++){
      const p = document.createElement("div");
      p.className = "petal";
      const left = Math.random()*100;
      const dur = 7 + Math.random()*8;
      const delay = Math.random()*6;
      const size = 10 + Math.random()*10;
      p.style.left = left + "vw";
      p.style.animationDuration = dur + "s";
      p.style.animationDelay = (-delay) + "s";
      p.style.width = size + "px";
      p.style.height = (size*1.25) + "px";
      p.style.opacity = (0.45 + Math.random()*0.4).toFixed(2);
      host.appendChild(p);
    }
  }

  // --- ğŸ•¯ï¸ Contador dÃ­as juntos ---
  function parseTogetherStart(){
    const d = state.together.startDate || "";
    const t = state.together.startTime || "00:00";
    if(!d) return null;
    // construimos fecha local (del dispositivo)
    const [Y,M,D] = d.split("-").map(Number);
    const [h,m] = (t || "00:00").split(":").map(Number);
    return new Date(Y, (M||1)-1, D||1, h||0, m||0, 0, 0);
  }
  function diffTogether(){
    const start = parseTogetherStart();
    if(!start) return null;
    const now = new Date();
    const ms = now - start;
    if(ms < 0) return { days: 0, hours: 0, minutes: 0, future: true };
    const totalMin = Math.floor(ms / 60000);
    const days = Math.floor(totalMin / (60*24));
    const hours = Math.floor((totalMin - days*60*24)/60);
    const minutes = totalMin % 60;
    return { days, hours, minutes, future: false };
  }
  function renderTogether(){
    const d = diffTogether();
    const label = sanitize(state.together.label) || "Juntos";
    const t1 = el("togetherText");
    const t2 = el("coverTogether");
    if(!d){
      t1.textContent = "configura fecha";
      if(t2) t2.textContent = "Configura la fecha ğŸ•¯ï¸";
      return;
    }
    const base = `${d.days} dÃ­as`;
    const fine = ` + ${d.hours}h ${d.minutes}m`;
    const text = d.future ? "AÃºn no empieza ğŸ˜¶" : (base + fine);
    t1.textContent = `${label}: ${text}`;
    if(t2) t2.textContent = `${base}${d.future ? "" : fine}`;
  }

  // --- Diario ---
  function addEntry(payload){
    const entry = {
      id: uid(),
      createdAt: nowISO(),
      mood: payload.mood || "ğŸ’–",
      toWho: sanitize(payload.toWho),
      title: sanitize(payload.title) || "Sin tÃ­tulo (pero con amor) ğŸ’˜",
      text: sanitize(payload.text),
    };
    state.entries.unshift(entry);
    save();
  }
  function updateEntry(id, patch){
    const i = state.entries.findIndex(e => e.id === id);
    if(i === -1) return;
    state.entries[i] = { ...state.entries[i], ...patch };
    save();
  }
  function deleteEntry(id){
    state.entries = state.entries.filter(e => e.id !== id);
    save();
  }

  // --- Agenda ---
  function addDate(payload){
    const name = sanitize(payload.name) || "Momento importante ğŸ’";
    const day = payload.day || "";
    if(!day){
      alert("Pon una fecha. El amor serÃ¡ libre, pero la agenda necesita fecha. ğŸ˜Œ");
      return;
    }
    const item = {
      id: uid(),
      createdAt: nowISO(),
      name,
      day,
      time: payload.time || "",
      note: sanitize(payload.note),
    };
    state.dates.push(item);
    state.dates.sort((a,b) => (a.day+a.time).localeCompare(b.day+b.time));
    save();
  }
  function deleteDate(id){
    state.dates = state.dates.filter(d => d.id !== id);
    save();
  }
  function daysUntil(dateStr){
    const today = new Date();
    const start = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const parts = dateStr.split("-").map(Number);
    const target = new Date(parts[0], parts[1]-1, parts[2]);
    const ms = target - start;
    return Math.round(ms / (1000*60*60*24));
  }
  function badgeColorByWindow(diff, windowDays){
    if(diff < 0) return "rgba(255,255,255,.12)";
    if(diff === 0) return "rgba(255,77,166,.30)";
    if(diff <= windowDays) return "rgba(255,209,102,.22)";
    if(diff <= windowDays*2) return "rgba(55,214,122,.16)";
    return "rgba(255,255,255,.10)";
  }

  // --- Render ---
  function renderEntries(){
    const q = sanitize(el("searchEntries").value).toLowerCase();
    const list = el("entriesList");
    list.innerHTML = "";

    let entries = [...state.entries];
    if(state.ui.sortEntries === "asc") entries.reverse();

    if(q){
      entries = entries.filter(e =>
        (e.title||"").toLowerCase().includes(q) ||
        (e.text||"").toLowerCase().includes(q) ||
        (e.toWho||"").toLowerCase().includes(q) ||
        (e.mood||"").toLowerCase().includes(q)
      );
    }

    entries.forEach(e => {
      const div = document.createElement("div");
      div.className = "item";

      const when = new Date(e.createdAt).toLocaleString();
      const who = e.toWho ? `â€¢ ${e.toWho}` : "";
      div.innerHTML = `
        <div class="topline">
          <div class="tag">${e.mood} ${when} ${who}</div>
          <div class="pill">ğŸ“Œ</div>
        </div>
        <h3 contenteditable="true" data-edit="title" spellcheck="true">${escapeHtml(e.title)}</h3>
        <p contenteditable="true" data-edit="text" spellcheck="true">${escapeHtml(e.text || "")}</p>
        <div class="btns no-print">
          <button data-act="editTo">ğŸ‘¤ Editar â€œParaâ€</button>
          <button data-act="delete" class="danger">ğŸ—‘ï¸ Borrar</button>
        </div>
      `;

      div.querySelectorAll("[contenteditable='true']").forEach(node => {
        node.addEventListener("input", () => {
          const field = node.getAttribute("data-edit");
          updateEntry(e.id, { [field]: node.innerText.trim() });
        });
      });

      div.querySelector("[data-act='delete']").addEventListener("click", () => {
        if(confirm("Â¿Borrar esta pÃ¡gina? Una vez se vaâ€¦ se va. ğŸ˜¶")){
          deleteEntry(e.id);
        }
      });

      div.querySelector("[data-act='editTo']").addEventListener("click", () => {
        const v = prompt("Â¿Para quiÃ©n es esta pÃ¡gina? (ej: Para Fran ğŸ’˜)", e.toWho || "");
        if(v !== null) updateEntry(e.id, { toWho: v.trim() });
      });

      list.appendChild(div);
    });
  }

  function renderDates(){
    const list = el("datesList");
    list.innerHTML = "";
    const windowDays = Number(el("reminderWindow").value);

    state.dates.forEach(d => {
      const diff = daysUntil(d.day);
      const bg = badgeColorByWindow(diff, windowDays);
      const div = document.createElement("div");
      div.className = "item";
      div.style.background = bg;

      const time = d.time ? ` ${d.time}` : "";
      const when = `${d.day}${time}`;
      const diffTxt = diff < 0 ? `PasÃ³ hace ${Math.abs(diff)} dÃ­a(s)` :
                      diff === 0 ? "Â¡Es hoy! ğŸ’¥ğŸ’–" :
                      `Faltan ${diff} dÃ­a(s)`;

      div.innerHTML = `
        <div class="topline">
          <div class="tag">ğŸ—“ï¸ ${when}</div>
          <div class="pill">${diffTxt}</div>
        </div>
        <h3>${escapeHtml(d.name)}</h3>
        <p>${escapeHtml(d.note || "")}</p>
        <div class="btns no-print">
          <button data-act="toEntry">ğŸ“ Convertir en pÃ¡gina</button>
          <button data-act="delete" class="danger">ğŸ—‘ï¸ Borrar</button>
        </div>
      `;

      div.querySelector("[data-act='delete']").addEventListener("click", () => {
        if(confirm("Â¿Borrar esta fecha? Luego no digas â€˜se me pasÃ³â€™. ğŸ˜Œ")){
          deleteDate(d.id);
        }
      });

      div.querySelector("[data-act='toEntry']").addEventListener("click", () => {
        const title = `${d.name} ${d.time ? "â°" : ""} ${d.day} ğŸ’`;
        const text = (d.note ? d.note + "\n\n" : "") +
          "Hoy escribo esto para que no se lo lleve el tiempo:\n" +
          "â€” ";
        addEntry({ mood:"ğŸ’Œ", toWho: "Para mi amor ğŸ’˜", title, text });
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      list.appendChild(div);
    });
  }

  function renderCounts(){
    el("countEntries").textContent = state.entries.length;
    el("countDates").textContent = state.dates.length;
  }
  function renderManifest(){
    if(!state.manifest){
      state.manifest = el("manifest").textContent.trim();
    }
    el("manifest").textContent = state.manifest || "";
  }
  function renderAll(){
    renderCounts();
    renderManifest();
    renderTogether();
    renderEntries();
    renderDates();
    syncSettingsUI();
  }

  // --- Forms ---
  function clearEntryForm(){
    el("toWho").value = "";
    el("mood").value = "ğŸ’–";
    el("entryTitle").value = "";
    el("entryText").value = "";
  }
  function clearDateForm(){
    el("dateName").value = "";
    el("dateDay").value = "";
    el("dateTime").value = "";
    el("dateNote").value = "";
  }

  // --- Modales ---
  const settingsBack = el("settingsBack");
  const secretBack = el("secretBack");

  function openModal(backEl){
    backEl.classList.add("show");
    backEl.setAttribute("aria-hidden","false");
  }
  function closeModal(backEl){
    backEl.classList.remove("show");
    backEl.setAttribute("aria-hidden","true");
  }

  // Ajustes UI sync
  function syncSettingsUI(){
    el("togetherDate").value = state.together.startDate || "";
    el("togetherTime").value = state.together.startTime || "";
    el("togetherLabel").value = state.together.label || "";
  }

  // --- ğŸ’Œ Secretos (ofuscaciÃ³n simple) ---
  function simpleHash(str){
    // hash rÃ¡pido (no cripto serio): para validar â€œmisma claveâ€
    let h = 2166136261;
    for(let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return (h>>>0).toString(16);
  }
  function xorBytes(text, key){
    const t = new TextEncoder().encode(text);
    const k = new TextEncoder().encode(key);
    const out = new Uint8Array(t.length);
    for(let i=0;i<t.length;i++){
      out[i] = t[i] ^ k[i % k.length];
    }
    return out;
  }
  function toB64(u8){
    let s = "";
    u8.forEach(b => s += String.fromCharCode(b));
    return btoa(s);
  }
  function fromB64(b64){
    const bin = atob(b64);
    const out = new Uint8Array(bin.length);
    for(let i=0;i<bin.length;i++) out[i] = bin.charCodeAt(i);
    return out;
  }
  function decryptPayload(key){
    if(!state.secrets.payload) return "";
    const bytes = fromB64(state.secrets.payload);
    const k = new TextEncoder().encode(key);
    const out = new Uint8Array(bytes.length);
    for(let i=0;i<bytes.length;i++){
      out[i] = bytes[i] ^ k[i % k.length];
    }
    return new TextDecoder().decode(out);
  }
  function encryptAndStore(key, text){
    const bytes = xorBytes(text, key);
    state.secrets.payload = toB64(bytes);
    state.secrets.keyHash = simpleHash(key);
    save();
  }

  // --- Eventos: Diario/Agenda ---
  el("btnSaveEntry").addEventListener("click", () => {
    const payload = {
      toWho: el("toWho").value,
      mood: el("mood").value,
      title: el("entryTitle").value,
      text: el("entryText").value
    };
    if(!sanitize(payload.text) && !sanitize(payload.title)){
      alert("Escribe algo, aunque sea una lÃ­nea. La eternidad no se llena sola. ğŸ˜Œ");
      return;
    }
    addEntry(payload);
    clearEntryForm();
  });
  el("btnClearEntry").addEventListener("click", clearEntryForm);

  el("btnSaveDate").addEventListener("click", () => {
    addDate({
      name: el("dateName").value,
      day: el("dateDay").value,
      time: el("dateTime").value,
      note: el("dateNote").value
    });
    clearDateForm();
  });
  el("btnClearDate").addEventListener("click", clearDateForm);

  el("btnNewEntry").addEventListener("click", () => { clearEntryForm(); el("entryTitle").focus(); });
  el("btnNewDate").addEventListener("click", () => { clearDateForm(); el("dateName").focus(); });

  // Dock mÃ³vil
  el("dockNewEntry").addEventListener("click", () => { clearEntryForm(); el("entryTitle").focus(); window.scrollTo({top:0,behavior:"smooth"}); });
  el("dockNewDate").addEventListener("click", () => { clearDateForm(); el("dateName").focus(); window.scrollTo({top:0,behavior:"smooth"}); });
  el("dockSecret").addEventListener("click", () => openModal(secretBack));
  el("dockSettings").addEventListener("click", () => openModal(settingsBack));

  // Autosave typing
  ["toWho","mood","entryTitle","entryText","dateName","dateDay","dateTime","dateNote","searchEntries","reminderWindow"].forEach(id=>{
    el(id).addEventListener("input", scheduleSave);
    el(id).addEventListener("change", scheduleSave);
  });

  // Sorting
  el("btnSortEntries").addEventListener("click", () => {
    state.ui.sortEntries = (state.ui.sortEntries === "desc") ? "asc" : "desc";
    el("btnSortEntries").textContent = state.ui.sortEntries === "desc" ? "â†•ï¸ Orden: reciente" : "â†•ï¸ Orden: antiguo";
    save();
  });

  // Manifest
  el("btnEditManifest").addEventListener("click", () => {
    const v = prompt("Edita tu manifiesto (corto, directo, real):", state.manifest || "");
    if(v !== null){
      state.manifest = v.trim();
      save();
    }
  });

  // Export / Import
  el("btnExport").addEventListener("click", () => {
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    const stamp = new Date().toISOString().slice(0,10);
    a.download = `nuestra_historia_${stamp}.json`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  });
  el("btnImport").addEventListener("click", () => el("fileImport").click());
  el("fileImport").addEventListener("change", async (ev) => {
    const file = ev.target.files && ev.target.files[0];
    if(!file) return;
    try{
      const text = await file.text();
      const incoming = JSON.parse(text);
      if(!incoming || typeof incoming !== "object") throw new Error("Formato invÃ¡lido");
      const ok = confirm("Â¿Importar y REEMPLAZAR tu historia actual por la del archivo?\n(Si no, cancela y exporta antes).");
      if(!ok) return;

      state.meta = incoming.meta || state.meta;
      state.manifest = incoming.manifest || state.manifest;
      state.entries = Array.isArray(incoming.entries) ? incoming.entries : [];
      state.dates = Array.isArray(incoming.dates) ? incoming.dates : [];
      state.ui = incoming.ui || state.ui;

      // nuevos bloques:
      state.together = { ...state.together, ...(incoming.together || {}) };
      state.secrets  = { ...state.secrets,  ...(incoming.secrets  || {}) };

      save();
      alert("Listo. Tu historia volviÃ³ a respirar. ğŸ’–");
    }catch(e){
      alert("No pude importar ese archivo. AsegÃºrate que sea .json exportado desde aquÃ­.");
    }finally{
      ev.target.value = "";
    }
  });

  // Print
  el("btnPrint").addEventListener("click", () => window.print());

  // Reset
  el("btnReset").addEventListener("click", () => {
    const ok = confirm("Â¿Borrar TODO?\nEsto es como quemar cartas. Si no estÃ¡s 100% segura, mejor exporta primero. ğŸ˜¶");
    if(!ok) return;
    localStorage.removeItem(KEY);
    location.reload();
  });

  // --- Portada (enter) ---
  const cover = el("cover");
  el("btnEnter").addEventListener("click", () => cover.classList.add("hide"));
  el("btnOpenSettings").addEventListener("click", () => openModal(settingsBack));
  el("btnOpenSecret").addEventListener("click", () => openModal(secretBack));

  // Quick header buttons
  el("btnSecretQuick").addEventListener("click", () => openModal(secretBack));
  el("btnSettingsQuick").addEventListener("click", () => openModal(settingsBack));

  // Ajustes modal
  el("settingsClose").addEventListener("click", () => closeModal(settingsBack));
  el("btnCloseSettings").addEventListener("click", () => closeModal(settingsBack));
  settingsBack.addEventListener("click", (e) => { if(e.target === settingsBack) closeModal(settingsBack); });

  el("btnSaveSettings").addEventListener("click", () => {
    const d = el("togetherDate").value;
    if(!d){
      alert("Pon una fecha de inicio. Si no, el contador queda como poema incompleto. ğŸ˜Œ");
      return;
    }
    state.together.startDate = d;
    state.together.startTime = el("togetherTime").value || "00:00";
    state.together.label = el("togetherLabel").value || "Juntos";
    save();
    closeModal(settingsBack);
  });

  // Secretos modal
  el("secretClose").addEventListener("click", () => closeModal(secretBack));
  secretBack.addEventListener("click", (e) => { if(e.target === secretBack) closeModal(secretBack); });

  const secretZone = el("secretZone");
  const secretHint = el("secretHint");
  let unlockedKey = "";

  el("btnUnlock").addEventListener("click", () => {
    const key = sanitize(el("secretKey").value);
    if(!key){
      alert("Sin clave no hay cofre. Pon una. ğŸ’Œ");
      return;
    }
    if(state.secrets.keyHash && state.secrets.keyHash !== simpleHash(key)){
      alert("Esa clave no coincide. Ojo: aquÃ­ no se adivina, se recuerda. ğŸ˜Œ");
      return;
    }
    unlockedKey = key;
    secretZone.style.display = "block";
    secretHint.style.display = "none";
    // cargar texto
    try{
      el("secretText").value = decryptPayload(key) || "";
    }catch(_){
      el("secretText").value = "";
    }
    el("secretText").focus();
  });

  el("btnSaveSecret").addEventListener("click", () => {
    if(!unlockedKey){
      alert("Primero desbloquea con tu clave.");
      return;
    }
    encryptAndStore(unlockedKey, el("secretText").value || "");
    alert("Secreto guardado. Nadie ve esto si tÃº no quieres. ğŸŒ¹");
  });

  el("btnLock").addEventListener("click", () => {
    unlockedKey = "";
    el("secretKey").value = "";
    el("secretText").value = "";
    secretZone.style.display = "none";
    secretHint.style.display = "block";
    closeModal(secretBack);
  });

  // Easter: mantener presionada la ğŸŒ¹ para abrir secretos
  const roseHeader = el("roseHeader");
  let pressTimer = null;
  const pressStart = () => {
    clearTimeout(pressTimer);
    pressTimer = setTimeout(() => openModal(secretBack), 900);
  };
  const pressEnd = () => clearTimeout(pressTimer);
  roseHeader.addEventListener("mousedown", pressStart);
  roseHeader.addEventListener("mouseup", pressEnd);
  roseHeader.addEventListener("mouseleave", pressEnd);
  roseHeader.addEventListener("touchstart", pressStart, {passive:true});
  roseHeader.addEventListener("touchend", pressEnd);

  // --- Init ---
  load();
  seedPetals();

  // Seed manifesto if not present
  if(!state.manifest){
    state.manifest = el("manifest").textContent.trim();
  }

  // Seed first page if empty
  if(state.entries.length === 0){
    state.entries.unshift({
      id: uid(),
      createdAt: nowISO(),
      mood: "ğŸŒ¹",
      toWho: "Para mi amor ğŸ’˜",
      title: "PÃ¡gina 1: El comienzo",
      text:
`Hoy abro este espacio como quien abre un cofre.
AquÃ­ vamos a guardar lo que sÃ­ vale: miradas, promesas, fechas y detalles.
Si el tiempo correâ€¦ que corra. Nosotros dejamos huella. â™¾ï¸`
    });
  }

  renderAll();
  el("lastSaved").textContent = "Ãšltimo guardado: " + new Date().toLocaleString();

  // actualizar contador cada 20s
  setInterval(renderTogether, 20000);

})();
</script>

</body>
</html>
